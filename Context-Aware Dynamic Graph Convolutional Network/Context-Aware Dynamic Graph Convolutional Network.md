# 基于上下文感知动态图卷积网络的高光谱图像分类
## 摘要
- 传统的基于空间上下文的方法只是假设空间上相邻的像素对应于同一土地覆盖类别，因此在复杂情况下往往无法正确发现像素之间的上下文关系，从而导致分类结果在一些不规则或不均匀的区域较差，如边界
- 基于最近提出的图卷积网络（GCN）开发了一种新的HSI分类方法，它可以灵活地编码任意结构的非欧几里德数据之间的关系。与传统的GCN不同，我们的方法采用了两种新的策略来进一步利用上下文关系进行HSI的精确分类。（1）由于传统GCN的接受域通常局限于相当小的邻域，我们提出了通过对从原始二维图像网格转换而来的学习区域诱导图进行连续的图卷积来捕获HSI中的远程上下文关系。（2）通过对图的边缘权值和图像区域之间的连接关系进行细化，同时学习改进的相似性度量和边缘滤波器，使图能够逐步细化以适应每个图卷积层生成的表示。
## 引言 
- 有效地利用上下文关系，本文提出了一种新的上下文感知动态图卷积网络（CAD-GCN）。GCN可以灵活地保留HSI中的目标边界等复杂区域。同时，通过高层次的上下文特征，可以自然地提取出高层次的特征。
- 为了捕捉长程相关性，提出的方法学习将原始HSI投影到一个区域诱导图中，并对图像区域之间的上下文关系进行编码，使得GCN的感受野不仅仅局限于一个相当小的区域。然后，通过在区域之间以及沿着连接它们的边传递消息，可以进行推理。因此，这种推理不仅可以更新区域特征，而且可以通过连续的图卷积将原来远离二维空间的区域连接起来。因此，可以有效地利用远图像区域之间的远程关系。在此基础上，提出的CAD-GCN只需少量节点就可以学习到有效的图形表示。最后，将学习的区域级特征通过恢复先前的图投影步骤中的像素到区域分配来插值到二维特征映射中，从而获得完全符合现有网络的像素级特征。利用上述的图投影和重投影框架，网络可以灵活地对形成的区域及其特征进行端到端的学习，有效地纠正了预计算区域特征不准确带来的负面影响
- 在所提出的CAD-GCN中，还使图形能够动态更新，以迭代方式细化区域间的上下文关系。更新过程可以分为两个部分，分别是节点相似度的细化和连接关系的细化。考虑到基于欧几里德距离的预定义图可能不适合度量它们的内在相似性[19]，我们打算学习改进的相似性度量。具体地说，图形可以动态地更新以适应每个图卷积层生成的区域表示，从而产生改进的表示。此外，我们通过引入“边缘滤波器”来进一步细化学习图，因为图中可能包含不正确的类间连接，特别是在不同土地覆盖物之间的边界附近。
- 以前的一项工作“多尺度动态GCN”（MDGCN）[20]也将GCN用于HSI分类。然而，本文在两个方面与MDGCN有很大的不同。首先，在MDGCN中，通过启发式超像素生成技术粗略地生成区域，这种方法可能是不精确的，并且在整个分类过程中不会发生变化。相比之下，我们的CAD-GCN中的区域是通过投影和重投影步骤自适应学习的，这样它们就能很好地适应图像中的物体外观。第二，与MDGCN无法细化图节点之间的连接关系，我们的CAD-GCN可以动态更新连接不同图像区域的图形边缘，从而使上下文关系得到更好的利用
## PROPOSED METHOD
- 图1。给定输入图像[图1（a）]，我们首先通过学习将具有二维像素网格的原始图像投影到图形数据中来获得其区域特征[图1（b）]。然后进行动态图卷积[图1（c）和（d）]来细化获得的区域图，以及每个区域的编码特征。最后，分类结果[图1（e）]是通过基于区域到像素分配将学习的图形表示插值到二维网格中来生成的。
### A. GCN
- (1) 向图的形式化定义为G=（V，E），V和E分别表示节点集和边集。符号A表示G的邻接矩阵，表示每对节点之间存在一条边，其（i，j）第个元素可计算为(1).γ被设置为0.2,xi和xj代表两个图节点，N(x j )是xj的领域集合。
- (2)图的谱滤波，可以表示为在Fourier domain通过gθ = diag(θ)对信号x滤波。为了对G进行节点嵌入。U是由归一化图拉普拉斯L的特征向量组成的矩阵。Λ一个包含L特征值的对角矩阵。D是度矩阵。I是单位矩阵。
- (3)通过切比雪夫多项式Tk（x）的截断展开逼近gθ（λ），达到Kth阶，为了减少方程（2）中特征向量分解的计算消耗。θ? 是切比雪夫系数Λ的一个向量，λmax是L的最大特征值
- (4)滤波器gθ对信号x的卷积，切比雪夫多项式定义为Tk（x）=2xTk−1（x）−Tk−2（x），T0（x）=1，T1（x）=x。L表示标度拉普拉斯矩阵。这个表达式是关于拉普拉斯（即K-局部化）的第K阶多项式。也就是说，过滤只依赖于距离中心节点最多K步的节点。
- (5)利用线性公式，Kipf和Welling[31]进一步逼近λmax≈2，因为神经网络参数可以在训练过程中适应这种尺度变化。因此，式（4）可简化为（5）.θ0和θ1是两个自由参数.
- (6)减少参数的数量有利于解决过拟合，公式（5）变为（6）
- 由于I+D−(1/2)AD−(1/2)的特征值范围是[0, 2],重复利用（6）操作会导致深度网络的数值不稳定和梯度消或爆炸。为了解决上述问题，执行重归一化。
- (7)GCN模型的卷积操作。H(l)是第l层的输出，σ(·) 代表激活函数，如本文中的softplus function 。W(l)可训练的权重矩阵。
### B. Pixel-to-Region Assignment
- 虽然GCN能够捕捉图像像素之间的上下文关系，但像素级图形卷积的接受域通常是有限的[23]。为了有效地描述像素之间的长距离关系，我们打算超越常规的二维图像网格，并对区域之间的上下文关系进行编码，因为图像区域之间的依赖比像素级卷积捕获的依赖要长得多[23]。其主要思想是学习像素到区域分配，将具有相似特征的像素划分为相干区域，以捕捉原始二维空间中原始区域之间的上下文关系。
- （8）soft assignment matrix P .将原始HSI转换成区域图，这个过程称为图投影。具体地说，网络将学习一个以V∈Rd×c参数化的软分配矩阵来分配每个像素的光谱维数，c是像素zi∈Rd到其相邻区域的个数，其中d表示图像区域，V的每列vi∈Rd对应于一个区域的锚定点。n是像素个数，?N(zi ) 是连接像素zi相邻区域像素集。元素Pij定义了像素zi到vi的软分配。
- （9）区域特征xj可以通过学习得到的像素到区域分配编码得到。通过学习每个区域的特征，可以减少不准确的预计算区域特征的负面影响。
- 在某些极端情况下，大多数甚至全部图像像素可能被分配到单个区域，因此仍然存在优化挑战。这可能是因为图像区域V的锚点矩阵初始化不当，导致赋值矩阵P不适定，而且分配不平衡会导致不良的图结构，从而不能充分利用上下文关系。为了解决这个问题，我们不需要随机初始化V，而是考虑空间信息，利用分割技术初始化V。具体来说，我们采用了广泛应用于图像分割的简单线性迭代聚类（SLIC）算法[25]来获得初始区域。在此，将利用对应区域中涉及的像素的平均光谱签名来初始化每个vi，并且可以通过使用梯度下降进一步更新矩阵V。
- 图2。在我们的CAD-GCN模型中使用的软像素到区域分配的说明。每个初始化的图像区域被黄线包围，蓝色箭头表示关于像素zi到其相邻区域的分配。利用学习到的区域特征，使用（1）可以自然地获得相应的区域图。之后，区域特征X将通过执行图卷积[18]重新计算，该卷积沿着边缘聚集信息。此外，通过连续的图卷积，可以捕捉到远离原始二维空间的区域之间的长程依赖关系
### C. Dynamic Graph Refinement
- （10）广义马氏距离.图卷积的性能很大程度上取决于预先定义的图的质量，该图编码了图节点之间的相似性和连接关系。然而，广泛用于描述节点相似性的欧几里德距离[例如，在（1）]中，可能不是图结构数据的良好度量[19]。为了解决这个缺点，我们打算学习一种改进的距离度量。具体地说，我们构造了一个对称的半正定矩阵M=WdW？d，Wd是一个可训练的权重矩阵。
- 邻接矩阵可以写成用马氏距离表示的形式。
- （12）为（11）重写。由于图的表示随着图的卷积层而更新，学习单个矩阵M不足以精确测量所有层的节点相似性。因此，我们自适应地学习第l层使用的邻接矩阵A（l）的对称半正定参数矩阵M（l），以获得改进的节点相似度。
- 在图的构造过程中，可能会合并不同类别的区域之间的连接，这将导致类间特征信息的聚集，进而降低图卷积结果的可分辨性。为了克服这一不足，我们建议使用边缘过滤器，其目的是通过减少图中不需要的类间边缘来细化上下文关系。由于类内示例通常比类内示例更相似，因此认为值相对较小的元素A（l）ij比值大的A（l）ij更可能表示类间关系。因此，我们对每个图卷积层使用一个阈值β（l）来过滤类间关系，减少类间特征聚合的不利影响。
- (13) 边缘滤波器F(·)
-（14）有了边缘滤波器，图H（l）在实践中，限制参数的数量有助于解决过度拟合的问题[18]，因此，当我们为所有层设置β（l）=β时，可以重新计算卷积层
### D. Region-to-Pixel Assignment 
- 在进行区域级的动态图卷积后，需要将新的区域特征（即学习的图表示）H（L）重新投影到具有像素网格的二维图像中，这一过程称为图重投影。具体地说，区域到像素的分配是通过基于软分配矩阵P（即PH（L）的像素特征线性插值来完成的，其中L表示图形卷积层的数目。需要注意的是，所有重投影像素将具有不同的特征表示，即使其中一些被分配到相同的区域。因此，可以很好地保存HSI的上下文细节。
- （15）CAD-GCN 输出
- （16）交叉熵损失函数，其中C是类的数目，yG表示与标记像素对应的索引集，Y表示标签矩阵。在此，如果像素zi属于第j类，则我们让Yij为1，否则为0。
- 算法1

##  EXPERIMENTAL RESULTS
### A. Data Sets
- Indian Pines。 Fig. 3，The amounts of labeled and unlabeled pixels of various classes are listed in Table I.
- University of Pavia。Fig. 4.Table II shows the amounts of labeled and unlabeled pixels of each class.
- Salinas.Fig. 5,The numbers of labeled and unlabeled pixels of different classes are listed in Table III.
- Houston University.Fig. 6. Table IV exhibits the numbers of labeled and unlabeled pixels of each class.
### B. Experimental Settings
- 每个类随机选择30个标记像素（即示例）进行训练，如果相应的类包含少于30个像素，则选择15个标记像素。
- 三种基于GCN的方法，即GCN[18]、光谱空间GCN（S2GCN）[26]和MDGCN[20]，以及一种基于CNN的方法，如CNN像素对特征（CNN PPFs）[27]。同时，我们还将所提出的CAD-GCN与两种传统的HSI分类方法，即多波段压缩纹理单元（MBCTU）[15]和多特征学习（MFL）[29]进行了比较。
### C. Classification Results
- Table V,Fig. 7,the Indian Pines data set 
- Table VI,Fig. 8 ,Results on the University ofPavia Data Set
