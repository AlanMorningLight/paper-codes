# DR-CNN
This example implements the paper [Diverse Region-based CNN for Hyperspectral Image Classification](https://ieeexplore.ieee.org/document/8304691/)
Evaluated on the dataset of Inddian Pines, Salinas and Pavia. 

## Prerequisites
- System *Ubuntu 14.04 or upper* 
- Python 2.7 or 3.6
- Packages
```
pip install -r requirements.txt
```



## How to run the code：

**Please modify 'save_path'，'PATH'，'NUM_CLASS','mdata_name','dataset' in file 'consruct_multi_mat.py', and 'mask_train' is the name of train_label 
 
python consruct_multi_mat.py --train_label_name mask_train --ksize 11

**Please modify 'PATH'，'TEST_PATH'，'NUM_CLASS','HEIGHT','WIDTH','NUM_CHN' in file 'data_util.py'
  
python main.py 







## Detail Information for Each Function-------------------------------------------------------------------------------------------------------------##
1.the main function of file "consruct_multi_mat.py", data preprocessing：
                    1) generate training data with shape 11*11*d,7*11*d,7*11*d,11*7*d,11*7*d,3*3*d (d is the dimension of Hyperspectral data)
                       training data (named train_data_H) including all the training patches for pixels provided with concrete label in mask_train
                       train_data_H:'data',
                                    'XR',
                                    'XL',
                                    'XU',
                                    'XB',
                                    'XC',
                                    'label'
                    2)  generate test data with shape 11*11*d,7*11*d,7*11*d,11*7*d,11*7*d,3*3*d (d is the dimension of Hyperspectral data)
                        test data (named test_data_Hi) including all the test patches for pixels provided with concrete label i in mask_test_patchi
                       test_data_Hi:'hsi',
                                    'XR',
                                    'XL',
                                    'XU',
                                    'XB',
                                    'XC',
                                    'label'
                        test_data_Hi, i depends on different class in mask_test

         ****When use aforementioned file 'consruct_multi_mat.py'，change 'save_path'，'PATH'，'NUM_CLASS','mdata_name','dataset' in file 'consruct_multi_mat.py' while use your own data for simulation

2. HSI_multi_SPA.py:
                    1) --mode 0 is for training the model(train_KEY,test_KEY,ksize1,ksize2)

                    2) --mode 1 is for testing the model(train_KEY,test_KEY,ksize1,ksize2)
                        For saving memory, all the test procedures are implemented class by class，each test operation is carried out based on 'test_data_Hi' dataset. 
                        the test result will be obtained by combining sub-results of per class.
         ****When use aforementioned file 'HSI_multi_SPA.py'，change 'PATH'，'TEST_PATH'，'NUM_CLASS','HEIGHT','WIDTH','NUM_CHN' in file 'data_util.py'

3. HSI_multiSPA_union.py:
                    1) --mode 0 is for training the model
                        relying on train_data_H, which is generated by consruct_multi_mat.py/consruct_square_mat.py

                    2) --mode 1 is for testing the model
                        relying on test_data_Hi, which is generated by consruct_multi_mat.py/consruct_square_mat.py 
           
                        For saving memory, all the test procedures are implemented class by class，each test operation is carried out based on 'test_data_Hi' dataset. 
                        the test result will be obtained by combining sub-results of per class.
         ****When use aforementioned file 'HSI_multiSPA_union.py'，change 'PATH'，'TEST_PATH'，'NUM_CLASS','HEIGHT','WIDTH','NUM_CHN' in file 'data_util.py'

## Detail Information for Each Function------------------------------------------------------------------------------------------------------------------------------------##